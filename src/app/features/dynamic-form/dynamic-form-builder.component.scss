.builder {
  display: flex;
 // gap: 12px;
  align-items: flex-start;
  height: 100%; /* fill parent instead of min-height */
}
.left { flex: 0 0 380px; }
.left { max-height: 100%; overflow: auto; padding-right: 4px; border-right: 1px solid #E2E1E4; }
.left .ant-card { border: 0 !important; box-shadow: none !important; background: transparent;  }
.left .ant-card-head { border-bottom: 0; background: transparent; }
.left .ant-card-body { padding: 6px 8px; }
.center { flex: 1 1 auto; min-width: 0; }
.right { flex: 0 0 380px; height: 100%; overflow: auto; }
.right .ant-card { display: flex; flex-direction: column; }
.right .ant-card-body { overflow: auto; padding: 8px; }

.card { border-radius: 12px; }
.sticky { position: sticky; top: 12px; align-self: start; }
.mt { margin-top: 12px; }
.fill { height: 100%; }
:host ::ng-deep .ant-card-small > .ant-card-body:has(.right) {
  padding-top: 8px;
}
.left .toolbar {
  display: grid; grid-template-columns: repeat(2, 1fr);
  gap: 6px; margin-bottom: 8px;
}
.context-actions { display: flex; gap: 6px; margin-top: 6px; }

.palette { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; }

.io textarea { width: 100%; min-height: 120px; resize: vertical; }
.io-actions { margin-top: 6px; display: flex; gap: 6px; }

.center { overflow: hidden; }
.center .card { display: flex; flex-direction: column; overflow: visible; }
.center .card { position: relative; }
.center .ant-card.no-chrome,
.right .ant-card.no-chrome {
  border: 0 !important;
  box-shadow: none !important;
  border-radius: 0 !important;
  background: transparent;
}
/* Add a subtle right border to the preview (center) card to separate from inspector */
.center .ant-card.no-chrome { border-right: 1px solid #E2E1E4 !important; /* reserve space for history bar */ --hb-space: 52px; }
.center .ant-card.no-chrome .ant-card-body { padding: 8px; display: flex; flex-direction: column; flex: 1 1 auto; min-height: 0; }
.card-title { display: flex; flex-direction: column; line-height: 1.2; align-items: center; text-align: center; margin: 0; }
.card-title .t { font-weight: 600; font-size: 14px; }
.card-title .s { font-size: 12px; color: #64748b; }

.card-title { display: flex; flex-direction: column; line-height: 1.2; align-items: center; text-align: center; margin: 0; }
.card-title .t { font-weight: 600; font-size: 14px; }
.card-title .s { font-size: 12px; color: #64748b; }
.card.ant-card .ant-card-head { padding: 8px 0; }
.card.ant-card .ant-card-head-title { padding: 8px 0; display: flex; justify-content: center; }
.card .ant-card-head {
  border-bottom: 0;
  background: transparent;
}

.center .ant-card.no-chrome .ant-card-head { padding: 8px 0; }
.center .ant-card.no-chrome .ant-card-head-title { padding: 8px 0; display: flex; justify-content: center; width: 100%; }
.right .ant-card.no-chrome .ant-card-head { padding: 8px 0; }
.right .ant-card.no-chrome .ant-card-head-title { padding: 8px 0; display: flex; justify-content: center; width: 100%; }
.center .ant-card-head,
.right .ant-card-head { border-bottom: 0; background: transparent; }

/* Drawer triggers inside preview header on tablet/mobile */
.preview-extra-mobile { display: none; gap: 8px; align-items: center; height: 47px; padding: 0 8px; width: 100%; box-shadow: none; background: transparent; }
.preview-extra-mobile .sep { width: 1px; height: 18px; background: #e5e7eb; display: inline-block; }
.preview-extra-mobile .flex-spacer { flex: 1 1 auto; }
.preview-extra-mobile .sep { display: none; }
@media (max-width: 1280px) {
  .preview-extra-mobile { background: transparent; border: 0; box-shadow: none; width: 100%; }
}

/* Ensure left-panel cards inside drawers have no outer chrome, keep header separator */
.ant-drawer-body .card.ant-card { border: 0 !important; box-shadow: none !important; border-radius: 0 !important; background: transparent; }
.ant-drawer-body .card.ant-card .ant-card-head { border-bottom: 1px solid #E2E1E4; }
.mobile-only { display: none; }

/* Tablet and below: use drawer layout */
@media (max-width: 1280px) {
  .left, .right { display: none;  }
  .preview-extra-mobile { display: inline-flex; }
  .mobile-only { display: block; }
  /* Remove subtle right border on preview card in responsive */
  .center .ant-card.no-chrome { border-right: 0 !important; }
}
/* Desktop: make preview column fill the viewport and let inner preview scroll */
@media (min-width: 1281px) {
  .center { height: 100%; display: flex; flex-direction: column; }
  .center .ant-card.no-chrome { height: 100%; display: flex; flex-direction: column; }
  .center .ant-card.no-chrome .ant-card-body { flex: 1 1 auto; min-height: 0; }
}
.history-bar {
  position: absolute; left: 50%; bottom: 8px; transform: translateX(-50%);
  display: inline-flex; align-items: center; gap: 12px;
  background: #fff;
  border: 0; /* no border in edition bar */
  border-radius: 0; /* no radius in edition bar */
  box-shadow: 0 8px 24px rgba(0,0,0,.10);
  padding: 6px 10px;
  z-index: 10; /* render above preview content */
}
.history-bar .hb-left { display: inline-flex; gap: 6px; }
.history-bar .hb-mid { display: inline-flex; align-items: center; gap: 10px; }
.history-bar .hb-right { display: inline-flex; align-items: center; gap: 6px; margin-left: 8px; }
.history-bar .hb-toggle { display: inline-flex; align-items: center; gap: 6px; }
.history-bar .hb-bp { display: inline-flex; align-items: center; gap: 6px; }
.history-bar .hb-bp .hb-bp-select { min-width: 130px; }
.history-bar .hb-mode-btn .label { margin-left: 6px; }
/* Hide edit mode button on tablet/mobile (drawer context) */
@media (max-width: 1280px) {
  .history-bar .hb-mode-btn { display: none; }
}
.center .card .steps,
.center .card .sections,
.center .card .fields { overflow: auto; padding-right: 6px; }

.step, .section, .field {
  border: 1px solid #e8e8e8; border-radius: 10px; background: #fafafa;
  padding: 8px; margin-bottom: 8px; transition: .15s;
}
.step:hover, .section:hover, .field:hover {
  border-color: #bfbfbf; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,.06);
}
.selected { border-color: #1677ff; box-shadow: 0 0 0 2px rgba(22,119,255,.15); background: #fff; }

.step-header, .section-header { display: flex; justify-content: space-between; align-items: center; gap: 8px; margin-bottom: 8px; cursor: grab; }
.section-header .t { font-weight: 600; }
.section-header .d { font-size: 12px; color: #64748b; margin-top: 2px; }

.fields .field { display: flex; justify-content: space-between; align-items: center; gap: 6px; }
.field .f-label { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 70%; }
.field .span-ctrls { display: inline-flex; align-items: center; gap: 4px; }
.field .drag-handle { cursor: grab; padding: 0 4px; color: #94a3b8; user-select: none; }
.field .resize-handle {
  width: 10px; height: 20px; cursor: ew-resize;
  display: inline-block; background: rgba(0,0,0,0.06);
  border-radius: 4px; margin-left: 4px;
}

/* Grille 24 colonnes en fond pour aider au resize visuel */
.fields.grid.show-grid {
  position: relative;
  background-image:
    repeating-linear-gradient(
      to right,
      rgba(22, 119, 255, 0.08) 0,
      rgba(22, 119, 255, 0.08) calc((100% / 24) - 1px),
      transparent calc((100% / 24) - 1px),
      transparent calc(100% / 24)
    );
  background-size: 100% 100%;
}

.right .inspector-form nz-form-item { margin-bottom: 10px; }
.inspector-tabs .ant-tabs-nav { margin: 0 0 8px; }
.inspector-tabs .ant-tabs-ink-bar { transition: width .16s ease, transform .16s ease; }
.inspector-tabs .ant-tabs-tab { border-radius: 6px; transition: background-color .12s ease; }
.inspector-tabs .ant-tabs-tab:hover { background-color: rgba(17,17,17,0.03); }
.inspector-tabs .ant-tabs-tab .ant-tabs-tab-btn { display: inline-flex; align-items: center; gap: 6px; }
.inspector-tabs .ant-tabs-tab .ant-tabs-tab-btn span { line-height: 1; }

/* Inspector form micro-ergonomics (Apple-like subtlety) */
.right .ant-card .inspector-form .ant-form-item { padding: 4px 6px; border-radius: 6px; transition: background-color .12s ease; }
.right .ant-card .inspector-form .ant-form-item:hover { background-color: rgba(17,17,17,0.02); }
.right .ant-card .inspector-form .ant-form-item-label > label { color: #334155; font-weight: 500; }
.right .ant-card .inspector-form .ant-input,
.right .ant-card .inspector-form .ant-select-selector,
.right .ant-card .inspector-form .ant-input-number,
.right .ant-card .inspector-form .ant-switch {
  transition: box-shadow .12s ease, border-color .12s ease;
}
.right .ant-card .inspector-form .ant-input:focus,
.right .ant-card .inspector-form .ant-select-focused .ant-select-selector,
.right .ant-card .inspector-form .ant-input-number-focused,
.right .ant-card .inspector-form .ant-switch-checked {
  box-shadow: 0 0 0 2px rgba(17,17,17,0.08);
}

/* Optional sticky group titles if present */
.right .ant-card .inspector-form .group-title,
.right .ant-card .inspector-form h3.group-title,
.right .ant-card .inspector-form h4.group-title {
  position: sticky; top: 0; z-index: 1;
  background: #fff; padding: 6px 4px; margin: 6px 0; border-bottom: 1px solid #e5e7eb;
}
.inspector-tabs .ant-tabs-nav { margin: 0 0 8px; }
.inspector-tabs .ant-tabs-tab .ant-tabs-tab-btn { display: inline-flex; align-items: center; gap: 6px; }
.inspector-tabs .ant-tabs-tab i { font-size: 14px; color: #334155; }
.inspector-tabs .ant-tabs-tab.ant-tabs-tab-active i { color: #111; }
.inspector-form .ant-form-item { margin-bottom: 6px; }
.right .ant-card .inspector-form { max-width: none; margin: 0; }
.inspector-form .ant-form-item-label > label { color: #334155; font-weight: 500; }
/* Section headers inside inspector (title + subtitle + border below) */
.right .ant-card .inspector-form .ins-section-header { display: flex; justify-content: center; padding: 6px 0 8px; margin: 8px 0; border-bottom: 1px solid #E2E1E4; }
.right .ant-card .inspector-form .ins-mini-header { display: flex; justify-content: center; padding: 4px 0 6px; margin: 6px 0; border-bottom: 1px solid #eee; }
.right .ant-card .inspector-form .ins-mini-header .card-title .t { font-size: 13px; }
.right .ant-card .inspector-form .ins-mini-header .card-title .s { font-size: 11px; }
.right .ant-card .inspector-form .ant-divider { margin: 8px 0; }
.right .ant-card .inspector-form .ant-input,
.right .ant-card .inspector-form .ant-select-selector,
.right .ant-card .inspector-form .ant-input-number,
.right .ant-card .inspector-form .ant-picker {
  border-color: #e5e7eb;
}
.right .ant-card .inspector-form .ant-input:hover,
.right .ant-card .inspector-form .ant-select-selector:hover,
.right .ant-card .inspector-form .ant-input-number:hover,
.right .ant-card .inspector-form .ant-picker:hover {
  border-color: #d1d5db;
}
/* Revert drawer no-chrome override to default to avoid inspector issues */
/* Make drawer inspector scroll like left panel */
.ant-drawer-body { display: flex; flex-direction: column; height: 100%; }
.ant-drawer-body > * { flex: 1 1 auto; min-height: 0; }
.ant-drawer-body .ant-card { height: 100%; display: flex; flex-direction: column; }
.ant-drawer-body .ant-card-body { overflow: auto; }
.inline-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }

.bp { display: flex; flex-wrap: wrap; gap: 6px; }

/* Scroll fixes */
.left .tree { max-height: 320px; overflow: auto; }
.left .tree { position: relative; }
.left .tree .tree-node-label { cursor: context-menu; display: inline-block; width: 100%; }
.left .tree .ctx {
  position: absolute; z-index: 1000; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px;
  padding: 6px; display: grid; gap: 6px; box-shadow: 0 8px 24px rgba(0,0,0,.12);
}
.right .card.sticky { max-height: 100%; overflow: auto; }

.bottom .preview-frame {
  margin: 0 auto;
  background: #fcfcfc;
  border: 1px dashed #eee;
  border-radius: 10px;
  padding: 8px;
}
.preview-frame {
  margin: 0 auto;
  background: transparent;
  border: 0;
  border-radius: 0;
  padding: 0;
  flex: 1 1 auto;
  min-height: 100%; /* allow flex overflow */
  
  overflow-y: auto; /* scroll if content exceeds */
    overflow-x: hidden; /* scroll if content exceeds */

  padding-bottom: var(--hb-space); /* keep content clear of history bar */
}
.bottom .json {
  background: #0f172a; color: #e2e8f0; padding: 12px; border-radius: 10px;
  max-height: 280px; overflow: auto; font-size: 12px;
}
