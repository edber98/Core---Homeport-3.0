<div class="builder">
  <div class="controls">
    <button nz-button nzType="default" (click)="addStep()">Add Step</button>
    <button nz-button nzType="default" (click)="addSection()">Add Section</button>
    <button nz-button nzType="default" (click)="addField()">Add Field</button>
    <button nz-button nzType="default" (click)="select(schema)">Settings</button>
  </div>
  <div class="canvas">
    <div class="steps" *ngIf="schema.steps" cdkDropList [cdkDropListData]="schema.steps" (cdkDropListDropped)="dropStep($event)">
      <div class="step" *ngFor="let step of schema.steps; let si = index" cdkDrag (click)="select(step)">
        <div class="step-header">
          {{ step.title || 'Step ' + (si + 1) }}
          <div class="actions">
            <button nz-button nzSize="small" (click)="addSection(step); $event.stopPropagation()">+ Section</button>
            <button nz-button nzSize="small" nzDanger (click)="removeStep(step); $event.stopPropagation()">Delete</button>
          </div>
        </div>
        <div class="sections" cdkDropList [cdkDropListData]="step.sections" (cdkDropListDropped)="dropSection($event, step)">
          <div class="section" *ngFor="let section of step.sections" cdkDrag (click)="select(section)">
            <div class="section-header">
              {{ section.title || 'Section' }}
              <div class="actions">
                <button nz-button nzSize="small" (click)="addField(section); $event.stopPropagation()">+ Field</button>
                <button nz-button nzSize="small" nzDanger (click)="removeSection(section, step); $event.stopPropagation()">Delete</button>
              </div>
            </div>
            <div class="fields" cdkDropList [cdkDropListData]="section.fields || []" (cdkDropListDropped)="dropField($event, section)">
              <div class="field" *ngFor="let field of (section.fields || [])" cdkDrag (click)="select(field)">
                <span>{{ field.label || field.type }}</span>
                <button nz-button nzSize="small" nzDanger (click)="removeField(field, section); $event.stopPropagation()">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sections" *ngIf="schema.sections" cdkDropList [cdkDropListData]="schema.sections" (cdkDropListDropped)="dropSection($event)">
      <div class="section" *ngFor="let section of schema.sections" cdkDrag (click)="select(section)">
        <div class="section-header">
          {{ section.title || 'Section' }}
          <div class="actions">
            <button nz-button nzSize="small" (click)="addField(section); $event.stopPropagation()">+ Field</button>
            <button nz-button nzSize="small" nzDanger (click)="removeSection(section); $event.stopPropagation()">Delete</button>
          </div>
        </div>
        <div class="fields" cdkDropList [cdkDropListData]="section.fields || []" (cdkDropListDropped)="dropField($event, section)">
          <div class="field" *ngFor="let field of (section.fields || [])" cdkDrag (click)="select(field)">
            <span>{{ field.label || field.type }}</span>
            <button nz-button nzSize="small" nzDanger (click)="removeField(field, section); $event.stopPropagation()">Delete</button>
          </div>
        </div>
      </div>
    </div>
    <div class="fields" *ngIf="schema.fields" cdkDropList [cdkDropListData]="schema.fields" (cdkDropListDropped)="dropField($event)">
      <div class="field" *ngFor="let field of schema.fields" cdkDrag (click)="select(field)">
        <span>{{ field.label || field.type }}</span>
        <button nz-button nzSize="small" nzDanger (click)="removeField(field); $event.stopPropagation()">Delete</button>
      </div>
    </div>
  </div>
  <div class="inspector" *ngIf="selected">
    <form nz-form [formGroup]="inspector">
      <nz-form-item>
        <nz-form-label>Title</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="title" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Key</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="key" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Label</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="label" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Placeholder</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="placeholder" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Type</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="type" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Options</nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="options"></textarea>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>visibleIf</nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="visibleIf"></textarea>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>requiredIf</nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="requiredIf"></textarea>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>disabledIf</nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="disabledIf"></textarea>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item *ngIf="isSection(selected)">
        <nz-form-label>Grid Gutter</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="gridGutter" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item *ngIf="isField(selected)">
        <nz-form-label>Col</nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="col"></textarea>
        </nz-form-control>
      </nz-form-item>
      <ng-container *ngIf="selected === schema">
        <nz-form-item>
          <nz-form-label>Layout</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="layout" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>Label Align</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="labelAlign" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>Label Col</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="labelColSpan" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>Control Col</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="controlColSpan" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>WidthPx</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="widthPx" />
          </nz-form-control>
        </nz-form-item>
      </ng-container>
    </form>
  </div>
  <div class="preview">
    <app-dynamic-form [schema]="schema"></app-dynamic-form>
  </div>
  <div class="io">
    <textarea [(ngModel)]="json" [ngModelOptions]="{standalone: true}"></textarea>
    <button nz-button nzType="default" (click)="import()">Import</button>
    <button nz-button nzType="default" (click)="export()">Export</button>
  </div>
</div>
