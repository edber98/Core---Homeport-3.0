 <div *ngIf="visible" [ngStyle]="section.itemStyle">
    <h3 *ngIf="section.title" [ngStyle]="section.titleStyle || { margin: '16px 0 6px' }">{{ section.title }}</h3>
    <p *ngIf="section.description" [ngStyle]="section.descriptionStyle || { margin: '0 0 12px', color: '#6b7280' }">{{ section.description }}</p>

    <div style="margin-bottom:16px">
      <nz-row [nzGutter]="section.grid?.gutter || 16">
        <ng-container *ngFor="let f of section.fields; let i = index">
          <ng-container *ngIf="dfs.isFieldVisible(f, form)">
            <nz-col
              [nzSpan]="forceBp ? fieldSpanFor(f, forceBp) : null"
              [nzXs]="!forceBp ? dfs.getFieldSpans(f).xs : null"
              [nzSm]="!forceBp ? dfs.getFieldSpans(f).sm : null"
              [nzMd]="!forceBp ? dfs.getFieldSpans(f).md : null"
              [nzLg]="!forceBp ? dfs.getFieldSpans(f).lg : null"
              [nzXl]="!forceBp ? dfs.getFieldSpans(f).xl : null"
              [style.max-width.%]="forceBp ? fieldPercentFor(f, forceBp) : null"
              [style.flex-basis.%]="forceBp ? fieldPercentFor(f, forceBp) : null"
            >
              <div class="df-edit-item" [class.df-edit]="editMode" [class.df-edit-selected]="isSelected(f)"
                   (click)="onClickField(i, $event)">
                <ng-container [ngSwitch]="f.type">
                  <ng-container *ngSwitchCase="'section'">
                    <df-section [section]="$any(f)" [form]="form" [ui]="ui" [forceBp]="forceBp"
                                [editMode]="editMode" [selectedField]="selectedField"
                                [allowMove]="allowMove" [allowDelete]="allowDelete"
                                (moveField)="moveField.emit($event)"
                                (deleteField)="deleteField.emit($event)"
                                (selectField)="selectField.emit({ index: $event.index, field: ($any(f).fields||[])[ $event.index ], section: $any(f) })"></df-section>
                  </ng-container>
                  <ng-container *ngSwitchDefault>
                    <df-field [field]="f" [form]="form" [ui]="ui" (click)="onInnerFieldClick($event)"></df-field>
                  </ng-container>
                </ng-container>
                <div class="df-edit-actions" *ngIf="editMode">
                  <button nz-button nzSize="small" *ngIf="allowMove" (click)="moveField.emit({index: i, dir: 'up'}); $event.stopPropagation()">▲</button>
                  <button nz-button nzSize="small" *ngIf="allowMove" (click)="moveField.emit({index: i, dir: 'down'}); $event.stopPropagation()">▼</button>
                  <button nz-button nzSize="small" *ngIf="allowDelete" nzDanger (click)="deleteField.emit({index: i}); $event.stopPropagation()">✕</button>
                </div>
              </div>
            </nz-col>
          </ng-container>
        </ng-container>
      </nz-row>
    </div>
  </div>
